{% extends "layout.html" %}

{% block title %}Rollie NoWaste | {{ title }}{% endblock %}

{% block content %}

<div class="form-wrapper">
  <div class="info-card" id="pf">
    <div class="form-header">
      <h2>Search Communities</h2>
      <br>
      <input type="text" id="searchInput" class="search-box" placeholder="Search by name...">
    </div>
    <br>
    <div class="table" id="scanin-table">
      <div class="form-body">
        {% if current_user.plant.communities %}
        <table class="table-content" id="communityTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Community Name</th>
              <th>Population</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for c in current_user.plant.communities %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ c.name }}</td>
              <td>{{ c.get_population() }}</td>
              <td>
                {% if c.is_flagged %}
                  <span class="status-flagged">⚠️ Flagged</span>
                {% else %}
                  <span class="status-ok">✅ OK</span>
                {% endif %}
              </td>
              <td>
                <form method="POST" action="{{ url_for('toggle_flag', community_id=c.id) }}">
                  <button type="submit" class="btn {{ 'btn-unflag' if c.is_flagged else 'btn-flag' }}">
                    {{ 'Paid' if c.is_flagged else 'Flag' }}
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No communities recorded yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='js/community_search.js') }}"></script>

{% endblock %}
